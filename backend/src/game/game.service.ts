import { Injectable } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Game } from './game.entity';

@Injectable()
export class GameService {
  constructor(
    @InjectRepository(Game)
    private gameRepository: Repository<Game>,
  ) {}

  async seedIfEmpty() {
    const count = await this.gameRepository.count();
    if (count < 20) {
      await this.gameRepository.save([
        {
    id: 1,
    title: 'Split Fiction',
    platform: 'PC',
    price: 40.93,
    currency: 'EUR',
    discount: 18,
    cashback: 4.50,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'EA App',
    region: 'GLOBAL',
  },
  {
    id: 2,
    title: 'Split Fiction',
    platform: 'Xbox Series X|S',
    price: 34.14,
    currency: 'EUR',
    discount: 32,
    cashback: 3.76,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'Xbox Live',
    region: 'EUROPE',
  },
  {
    id: 3,
    title: 'Split Fiction',
    platform: 'Xbox Series X|S',
    price: 35.15,
    currency: 'EUR',
    discount: 30,
    cashback: 3.87,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'Xbox Live',
    region: 'GLOBAL',
  },
  {
    id: 4,
    title: 'Split Fiction',
    platform: 'Nintendo Switch',
    price: 36.25,
    currency: 'EUR',
    discount: 15,
    cashback: 3.99,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'Nintendo eShop',
    region: 'EUROPE',
  },
  {
    id: 5,
    title: 'FIFA 23',
    platform: 'PC',
    price: 19.99,
    currency: 'EUR',
    discount: 60,
    cashback: 2.50,
    imageUrl: 'https://image2url.com/r2/default/images/1768931375490-0e2f8b10-eecf-4cab-bdf9-3b438c9221da.jpg',
    store: 'EA App',
    region: 'GLOBAL',
  },
  {
    id: 6,
    title: 'Red Dead Redemption 2',
    platform: 'PC',
    price: 29.99,
    currency: 'EUR',
    discount: 50,
    cashback: 3.00,
    imageUrl: 'https://image2url.com/r2/default/images/1768931412969-96a7ab35-9e47-408a-bcae-2c7666051bf0.jpg',
    store: 'Rockstar',
    region: 'GLOBAL',
  },
  {
    id: 7,
    title: 'Split Fiction',
    platform: 'PC',
    price: 45.00,
    currency: 'EUR',
    discount: 10,
    cashback: 5.00,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'Steam',
    region: 'GLOBAL',
  },
  {
    id: 8,
    title: 'FIFA 23',
    platform: 'Xbox One',
    price: 24.50,
    currency: 'EUR',
    discount: 45,
    cashback: 1.50,
    imageUrl: 'https://image2url.com/r2/default/images/1768931375490-0e2f8b10-eecf-4cab-bdf9-3b438c9221da.jpg',
    store: 'Xbox Live',
    region: 'EUROPE',
  },
  {
    id: 9,
    title: 'Red Dead Redemption 2',
    platform: 'Xbox Series X|S',
    price: 35.99,
    currency: 'EUR',
    discount: 40,
    cashback: 2.20,
    imageUrl: 'https://image2url.com/r2/default/images/1768931412969-96a7ab35-9e47-408a-bcae-2c7666051bf0.jpg',
    store: 'Xbox Live',
    region: 'GLOBAL',
  },
  {
    id: 10,
    title: 'Split Fiction',
    platform: 'PS5',
    price: 49.99,
    currency: 'EUR',
    discount: 5,
    cashback: 1.00,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'PSN',
    region: 'USA',
  },
  {
    id: 11,
    title: 'FIFA 23',
    platform: 'PC',
    price: 15.99,
    currency: 'EUR',
    discount: 70,
    cashback: 0.80,
    imageUrl: 'https://image2url.com/r2/default/images/1768931375490-0e2f8b10-eecf-4cab-bdf9-3b438c9221da.jpg',
    store: 'Steam',
    region: 'LATAM',
  },
  {
    id: 12,
    title: 'Red Dead Redemption 2',
    platform: 'PC',
    price: 19.99,
    currency: 'EUR',
    discount: 65,
    cashback: 1.25,
    imageUrl: 'https://image2url.com/r2/default/images/1768931412969-96a7ab35-9e47-408a-bcae-2c7666051bf0.jpg',
    store: 'Epic Games',
    region: 'EUROPE',
  },
  {
    id: 13,
    title: 'Split Fiction',
    platform: 'PC',
    price: 38.50,
    currency: 'EUR',
    discount: 22,
    cashback: 4.10,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'EA App',
    region: 'EUROPE',
  },
  {
    id: 14,
    title: 'FIFA 23',
    platform: 'Nintendo Switch',
    price: 29.99,
    currency: 'EUR',
    discount: 25,
    cashback: 1.50,
    imageUrl: 'https://image2url.com/r2/default/images/1768931375490-0e2f8b10-eecf-4cab-bdf9-3b438c9221da.jpg',
    store: 'Nintendo eShop',
    region: 'GLOBAL',
  },
  {
    id: 15,
    title: 'Split Fiction',
    platform: 'Xbox One',
    price: 29.99,
    currency: 'EUR',
    discount: 40,
    cashback: 2.00,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'Xbox Live',
    region: 'ASIA',
  },
  {
    id: 16,
    title: 'Red Dead Redemption 2',
    platform: 'PS4',
    price: 25.00,
    currency: 'EUR',
    discount: 55,
    cashback: 2.50,
    imageUrl: 'https://image2url.com/r2/default/images/1768931412969-96a7ab35-9e47-408a-bcae-2c7666051bf0.jpg',
    store: 'PSN',
    region: 'EUROPE',
  },
  {
    id: 17,
    title: 'Split Fiction',
    platform: 'PC',
    price: 32.00,
    currency: 'EUR',
    discount: 35,
    cashback: 3.50,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'Steam',
    region: 'LATAM',
  },
  {
    id: 18,
    title: 'FIFA 23',
    platform: 'PS5',
    price: 35.00,
    currency: 'EUR',
    discount: 30,
    cashback: 3.00,
    imageUrl: 'https://image2url.com/r2/default/images/1768931375490-0e2f8b10-eecf-4cab-bdf9-3b438c9221da.jpg',
    store: 'PSN',
    region: 'GLOBAL',
  },
  {
    id: 19,
    title: 'Split Fiction',
    platform: 'Nintendo Switch',
    price: 42.00,
    currency: 'EUR',
    discount: 5,
    cashback: 4.20,
    imageUrl: 'https://image2url.com/r2/default/images/1768931394053-0a128f96-b61f-4412-a21c-58cd68009bf5.png',
    store: 'Nintendo eShop',
    region: 'GLOBAL',
  },
  {
    id: 20,
    title: 'Red Dead Redemption 2',
    platform: 'Xbox One',
    price: 22.99,
    currency: 'EUR',
    discount: 60,
    cashback: 2.00,
    imageUrl: 'https://image2url.com/r2/default/images/1768931412969-96a7ab35-9e47-408a-bcae-2c7666051bf0.jpg',
    store: 'Xbox Live',
    region: 'USA',
  }
      ]);
    }
  }

  async findAll(search?: string) {
    if (!search) {
      return this.gameRepository.find();
    }

    return this.gameRepository
      .createQueryBuilder('game')
      .where('LOWER(game.title) LIKE :search', {
        search: `%${search.toLowerCase()}%`,
      })
      .getMany();
  }
}
